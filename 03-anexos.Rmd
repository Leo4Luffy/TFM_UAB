```{r, echo = FALSE}

pacman::p_load(tibble, gt, dplyr, tidyr)
```

# (APPENDIX) Appendix {-}

## Anexo de los capitulos 1 y 2

```{r, echo = TRUE, eval = FALSE}

fn.mH <- function(ped, mG) { # Esta función recibe como argu-
                             # mentos los datos con estructu- 
                             # ra (id | sire | dam | Gen (TRUE 
                             # /FALSE)) y la matriz de relacio-
                             # nes genómicas.
  
  # 1. Se calcula la matriz de relaciones aditivas con base en 
  # el pedigrí (A)
  
  ped_edit <- pedigreemm::editPed( # Esta función ordena el pe-
                                   # digrí.
    sire = ped$sire,
    dam = ped$dam,
    label = ped$id
    )
  pedi <- pedigreemm::pedigree( # Aquí se usa la salida anterior
                                # (ya ordenado) y se crea un ob-
                                # jeto de clase pedigree.
    sire = ped_edit$sire,
    dam = ped_edit$dam,
    label = ped_edit$label
    )
  Matrix_A <- pedigreemm::getA(ped = pedi) # Esto dara la matriz
                                           # de relaciones adi-
                                           # tivas A.
 
  # 2. De lo anterior (Matriz_A) se extraen las partes correspon-
  # dientes a individuos no genotipados (1) y genotipados (2)
  
  # Individuos no genotipados:
  A_11 <- Matrix_A[ped$Genotiped != 1, ped$Genotiped != 1]
  # Individuos genotipados:
  A_22 <- Matrix_A[ped$Genotiped == 1, ped$Genotiped == 1]
  # Individuos no genotipados (en filas) y genotipados (en 
  # columnas):
  A_12 <- Matrix_A[ped$Genotiped != 1, ped$Genotiped == 1]
  # Transpuesta de la anterior (individuos no genotipados en 
  # columnas y genotipados en filas):
  A_21 <- t(A_12)
  
  # 3. Se coloca el nombre de las filas y y de las columnas 
  # de la matriz G según los individuos genotipados
  
  rownames(mG) <- ped$id[ped$Genotiped == 1]
  colnames(mG) <- ped$id[ped$Genotiped == 1]
  
  # 4. Teniendo todos los componentes de la matriz H, se pro-
  # cede a su construcción y a calcular su inversa
  
  H_11 <- A_11 - 
    (A_12 %*% solve(A_22) %*% A_21) + 
    (A_12 %*% solve(A_22) %*% mG %*% solve(A_22) %*% A_21)
  H_12 <- A_12 %*% solve(A_22) %*% mG
  H_21 <- t(H_12)
  H_22 <- mG
  
  H_11_H_12 <- cbind(H_11, H_12)
  H_21_H_22 <- cbind(H_21, H_22)
  mH <- rbind(H_11_H_12, H_21_H_22)
  
  mH <- mH[order(as.numeric(rownames(mH))), 
           order(as.numeric(colnames(mH)))]
  mH <- Matrix(mH)
  
  # 5. Finalmente se indica retornar la matriz H (mH)
  
  return(mH)
  }
```

```{r, echo = FALSE, out.width = "100%", fig.align = 'center', fig.showtext = TRUE}

Puntos <- data.frame(x = c(0.25, 1.25, 2.5, 3.5, 0.5, 2.75, 1.0, 1.5625), y = c(3.75, 3.75, 3.75, 3.75, 2.75, 2.75, 1.75, 0.75))
Cuadros <- data.frame(x = c(0.75, 1.75, 3.0, 4.0, 1.5, 3.75, 3.25, 2.125, 2.75), y = c(3.75, 3.75, 3.75, 3.75, 2.75, 2.75, 1.75, 1.75, 0.75))

data.frame(
  x = c(0.0:4.0), y = c(0.0:4.0)
  ) %>%
  ggplot(aes(x, y)) +
  #geom_blank() +
  
  geom_point(aes(x = x, y = y), data = Puntos, size = 11.6, shape = 21, color = 'cyan', fill = 'cyan', alpha = 0.2) +
  geom_point(aes(x = x, y = y), data = Cuadros, size = 11.6, shape = 22, color = 'yellow', fill = 'yellow', alpha = 0.2) +
  
  annotate(geom = 'segment', x = 0.25, xend = 0.25, y = 3.55, yend = 3.2, colour = 'black', size = 0.8, linetype = 'dashed') +
  annotate(geom = 'segment', x = 0.75, xend = 0.75, y = 3.55, yend = 3.2, colour = 'black', size = 0.8, linetype = 'dashed') +
  annotate(geom = 'segment', x = 0.25, xend = 0.5, y = 3.2, yend = 3.2, colour = 'black', size = 0.8, linetype = 'dashed') +
  annotate(geom = 'segment', x = 0.75, xend = 0.5, y = 3.2, yend = 3.2, colour = 'black', size = 0.8, linetype = 'dashed') +
  annotate(geom = 'segment', x = 0.5, xend = 0.5, y = 3.2, yend = 2.85, colour = 'black', size = 0.8, linetype = 'dashed') +
  
  annotate(geom = 'segment', x = 1.25, xend = 1.25, y = 3.55, yend = 3.2, colour = 'black', size = 0.8, linetype = 'dashed') +
  annotate(geom = 'segment', x = 1.75, xend = 1.75, y = 3.55, yend = 3.2, colour = 'black', size = 0.8, linetype = 'dashed') +
  annotate(geom = 'segment', x = 1.25, xend = 1.5, y = 3.2, yend = 3.2, colour = 'black', size = 0.8, linetype = 'dashed') +
  annotate(geom = 'segment', x = 1.75, xend = 1.5, y = 3.2, yend = 3.2, colour = 'black', size = 0.8, linetype = 'dashed') +
  annotate(geom = 'segment', x = 1.5, xend = 1.5, y = 3.2, yend = 2.85, colour = 'black', size = 0.8, linetype = 'dashed') +
  
  scale_x_continuous(limits = c(0.0, 4.25)) +
  scale_y_continuous(limits = c(0.25, 4.0)) +
  
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank(),
        plot.title = element_text(size = 14, face = 'bold')) #-> ssGBLUP

#knitr::include_graphics('figures/mA.pdf', auto_pdf = TRUE)
```
